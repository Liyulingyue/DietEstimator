# DietEstimator

åŸºäºAIçš„æ™ºèƒ½é¥®é£Ÿä¼°ç®—ç³»ç»Ÿï¼Œæä¾›é£Ÿç‰©çƒ­é‡è®¡ç®—ã€è¥å…»åˆ†æå’Œé¥®é£Ÿè®°å½•ç®¡ç†åŠŸèƒ½ã€‚

## é¡¹ç›®ä»‹ç»

DietEstimator æ˜¯ä¸€ä¸ªåˆ›æ–°çš„æ™ºèƒ½é¥®é£Ÿç®¡ç†å¹³å°ï¼Œåˆ©ç”¨AIè§†è§‰è¯†åˆ«æŠ€æœ¯å¸®åŠ©ç”¨æˆ·è½»æ¾è®°å½•å’Œç®¡ç†æ—¥å¸¸é¥®é£Ÿã€‚åªéœ€æ‹ç…§ä¸Šä¼ é£Ÿç‰©å›¾ç‰‡ï¼Œç³»ç»Ÿå°±èƒ½è‡ªåŠ¨è¯†åˆ«é£Ÿç‰©ç§ç±»ã€ä¼°ç®—çƒ­é‡å’Œè¥å…»æˆåˆ†ï¼Œè®©å¥åº·é¥®é£Ÿç®¡ç†å˜å¾—ç®€å•é«˜æ•ˆã€‚

### æ ¸å¿ƒåŠŸèƒ½

#### ğŸ¯ æ™ºèƒ½çƒ­é‡ä¼°ç®—
- **æ‹ç…§å³å¯åˆ†æ**ï¼šä¸Šä¼ é£Ÿç‰©ç…§ç‰‡ï¼ŒAIè‡ªåŠ¨è¯†åˆ«é£Ÿç‰©ç±»å‹å’Œä»½é‡
- **å¤šç§åˆ†ææ¨¡å¼**ï¼š
  - çº¯è§†è§‰AIåˆ†æ - é€‚ç”¨äºæ‰€æœ‰é£Ÿç‰©ç±»å‹
  - OCR+AIæ··åˆåˆ†æ - é’ˆå¯¹åŒ…è£…é£Ÿå“è¥å…»æ ‡ç­¾çš„ç²¾å‡†è¯†åˆ«
  - è¥å…»æˆåˆ†è¡¨æå– - è‡ªåŠ¨è¯†åˆ«å¹¶ç»“æ„åŒ–è¥å…»æ ‡ç­¾ä¿¡æ¯
  - é£Ÿç‰©ä»½é‡æ£€æµ‹ - æ™ºèƒ½è¯†åˆ«é£Ÿå“åŒ…è£…ä¸Šçš„ä»½é‡ä¿¡æ¯
- **å³æ—¶åé¦ˆ**ï¼šå®æ—¶è¿”å›çƒ­é‡ã€è›‹ç™½è´¨ã€ç¢³æ°´åŒ–åˆç‰©ã€è„‚è‚ªç­‰è¥å…»æ•°æ®

#### ğŸ“Š é¥®é£Ÿè®°å½•ç®¡ç†
- **å®Œæ•´çš„è®°å½•ç³»ç»Ÿ**ï¼šè®°å½•æ¯é¤çš„é£Ÿç‰©ç…§ç‰‡ã€æ—¶é—´ã€è¥å…»æ•°æ®
- **å†å²æ•°æ®æŸ¥è¯¢**ï¼šæŒ‰æ—¥æœŸã€æ—¶é—´æ®µæŸ¥çœ‹å†å²é¥®é£Ÿè®°å½•
- **æ•°æ®ç»Ÿè®¡åˆ†æ**ï¼šå›¾è¡¨å±•ç¤ºçƒ­é‡æ‘„å…¥è¶‹åŠ¿ã€è¥å…»æ¯”ä¾‹åˆ†å¸ƒ
- **ä¸ªæ€§åŒ–æ ‡ç­¾**ï¼šä¸ºè®°å½•æ·»åŠ å¤‡æ³¨ã€é¤æ¬¡æ ‡ç­¾ï¼ˆæ—©é¤/åˆé¤/æ™šé¤/åŠ é¤ï¼‰

#### ğŸ–¼ï¸ å›¾åº“ç®¡ç†
- **ç…§ç‰‡å½’æ¡£**ï¼šè‡ªåŠ¨ä¿å­˜æ‰€æœ‰åˆ†æè¿‡çš„é£Ÿç‰©ç…§ç‰‡
- **ä¾¿æ·å›é¡¾**ï¼šå¿«é€Ÿæµè§ˆå’Œæ£€ç´¢å†å²ç…§ç‰‡
- **å…³è”è®°å½•**ï¼šç…§ç‰‡ä¸é¥®é£Ÿè®°å½•è‡ªåŠ¨å…³è”ï¼Œæ–¹ä¾¿è¿½æº¯

#### ğŸ‘¤ ç”¨æˆ·ç³»ç»Ÿ
- **è´¦æˆ·æ³¨å†Œç™»å½•**ï¼šå®‰å…¨çš„ç”¨æˆ·è®¤è¯æœºåˆ¶
- **ä¸ªäººæ•°æ®éš”ç¦»**ï¼šæ¯ä¸ªç”¨æˆ·çš„æ•°æ®ç‹¬ç«‹å­˜å‚¨ï¼Œä¿æŠ¤éšç§
- **ä¼šè¯ç®¡ç†**ï¼šæ”¯æŒå¤šè®¾å¤‡ç™»å½•ï¼Œè‡ªåŠ¨ä¼šè¯ä¿æŒ

### åº”ç”¨åœºæ™¯

- **ğŸ‹ï¸ å¥èº«äººç¾¤**ï¼šç²¾ç¡®æ§åˆ¶çƒ­é‡æ‘„å…¥ï¼Œé…åˆè¿åŠ¨è¾¾æˆå¥èº«ç›®æ ‡
- **ğŸ©º å¥åº·ç®¡ç†**ï¼šæ…¢æ€§ç—…æ‚£è€…ï¼ˆå¦‚ç³–å°¿ç—…ã€é«˜è¡€å‹ï¼‰è¿›è¡Œé¥®é£Ÿç›‘æ§
- **âš–ï¸ ä½“é‡ç®¡ç†**ï¼šå‡é‡æˆ–å¢é‡äººç¾¤ç§‘å­¦ç®¡ç†é¥®é£Ÿ
- **ğŸ± è¥å…»å‡è¡¡**ï¼šå…³æ³¨è¥å…»å¥åº·çš„æ™®é€šç”¨æˆ·æ—¥å¸¸é¥®é£Ÿè®°å½•
- **ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦ å®¶åº­ä½¿ç”¨**ï¼šè®°å½•å®¶äººé¥®é£Ÿï¼Œå…³æ³¨å…¨å®¶å¥åº·

### æŠ€æœ¯äº®ç‚¹

- **å…ˆè¿›çš„AIæ¨¡å‹**ï¼šé›†æˆç™¾åº¦æ–‡å¿ƒä¸€è¨€è§†è§‰å¤§æ¨¡å‹ï¼Œè¯†åˆ«å‡†ç¡®ç‡é«˜
- **OCRæ–‡å­—è¯†åˆ«**ï¼šPaddleOCRæŠ€æœ¯ç²¾å‡†æå–è¥å…»æ ‡ç­¾ä¿¡æ¯
- **æ™ºèƒ½å†³ç­–ç³»ç»Ÿ**ï¼šæ ¹æ®å›¾ç‰‡ç‰¹å¾è‡ªåŠ¨é€‰æ‹©æœ€ä¼˜åˆ†ææ–¹æ¡ˆ
- **å¾®æœåŠ¡æ¶æ„**ï¼šå‰åç«¯åˆ†ç¦»ï¼ŒAIæœåŠ¡ç‹¬ç«‹éƒ¨ç½²ï¼Œæ˜“äºæ‰©å±•
- **å®¹å™¨åŒ–éƒ¨ç½²**ï¼šDocker Composeä¸€é”®éƒ¨ç½²ï¼Œå¼€å‘ç”Ÿäº§ç¯å¢ƒéš”ç¦»
- **æ•°æ®æŒä¹…åŒ–**ï¼šPostgreSQLå…³ç³»å‹æ•°æ®åº“ï¼Œæ•°æ®å®‰å…¨å¯é 

## æŠ€æœ¯æ ˆ

### åç«¯æœåŠ¡
- **ä¸»åç«¯ (Backend)**: FastAPI + PostgreSQL + SQLAlchemy + Alembic
- **AIåç«¯ (AIBackend)**: FastAPI + ç™¾åº¦æ–‡å¿ƒä¸€è¨€ + PaddleOCR
- **æ•°æ®åº“**: PostgreSQL 15
- **æ•°æ®åº“ç®¡ç†**: Adminer (ä»…å¼€å‘ç¯å¢ƒ)

### å‰ç«¯åº”ç”¨
- **æ¡†æ¶**: React 18 + TypeScript
- **æ„å»ºå·¥å…·**: Vite
- **UIç»„ä»¶**: Ant Design 5
- **è·¯ç”±**: React Router DOM 7
- **å›¾è¡¨**: Recharts

### éƒ¨ç½²ä¸å®¹å™¨åŒ–
- **å®¹å™¨**: Docker & Docker Compose
- **WebæœåŠ¡å™¨**: Nginx (ç”Ÿäº§ç¯å¢ƒ)
- **å¼€å‘å·¥å…·**: çƒ­é‡è½½ã€æºç æ˜ å°„

## é¡¹ç›®ç»“æ„

```
DietEstimator/
â”œâ”€â”€ Backend/                    # ä¸»åç«¯æœåŠ¡
â”œâ”€â”€ AIBackend/                  # AIåˆ†ææœåŠ¡
â”œâ”€â”€ Frontend/                   # Reactå‰ç«¯åº”ç”¨
â”œâ”€â”€ docker/                     # Dockeré…ç½®é›†ä¸­ç®¡ç†
â””â”€â”€ GradioProject/              # GradioåŸå‹ç•Œé¢ (å¯é€‰)
```

## å¿«é€Ÿå¼€å§‹

### å‰ç½®è¦æ±‚

- **Docker Desktop** (æ¨è)
- **Python 3.10+** (æœ¬åœ°å¼€å‘)
- **Node.js 18+** (æœ¬åœ°å¼€å‘)
- **Git**

### æ–¹å¼ä¸€ï¼šä½¿ç”¨Docker Compose (æ¨è)

**å¼€å‘ç¯å¢ƒå®Œæ•´éƒ¨ç½²**

```powershell
# å…‹éš†é¡¹ç›®
git clone [repository-url]
cd DietEstimator

# å¯åŠ¨æ‰€æœ‰æœåŠ¡ (æ•°æ®åº“ã€åç«¯ã€AIåç«¯ã€å‰ç«¯ã€Adminer)
docker-compose -f docker/docker-compose.dev.yml up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker/docker-compose.dev.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker/docker-compose.dev.yml logs -f
```

**è®¿é—®åœ°å€**ï¼š
- å‰ç«¯åº”ç”¨: http://localhost:5176
- ä¸»åç«¯API: http://localhost:8000/docs
- AIåç«¯API: http://localhost:8001/docs
- æ•°æ®åº“ç®¡ç† (Adminer): http://localhost:8080

**åœæ­¢æœåŠ¡**ï¼š
```powershell
docker-compose -f docker/docker-compose.dev.yml down
```

### æ–¹å¼äºŒï¼šæœ¬åœ°å¼€å‘ (æ”¯æŒçƒ­é‡è½½)

#### 1. å¯åŠ¨æ•°æ®åº“

```powershell
# ä»…å¯åŠ¨æ•°æ®åº“å’ŒAdminer
docker-compose -f docker/docker-compose.dev.yml up -d db adminer
```

#### 2. å¯åŠ¨ä¸»åç«¯

```powershell
cd Backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ (é¦–æ¬¡)
python -m venv venv
.\venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# é…ç½®ç¯å¢ƒå˜é‡ (å¤åˆ¶ .env.example åˆ° .env å¹¶ä¿®æ”¹)
copy .env.example .env

# å¯åŠ¨æœåŠ¡ (è‡ªåŠ¨æ‰§è¡Œæ•°æ®åº“è¿ç§»)
python run.py
```

#### 3. å¯åŠ¨AIåç«¯

```powershell
cd AIBackend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv venv
.\venv\Scripts\activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¯åŠ¨æœåŠ¡
python run.py
```

#### 4. å¯åŠ¨å‰ç«¯

```powershell
cd Frontend

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

**è®¿é—®åœ°å€**ï¼š
- å‰ç«¯: http://localhost:5176
- ä¸»åç«¯: http://localhost:8000
- AIåç«¯: http://localhost:8001
- Adminer: http://localhost:8080

### Admineræ•°æ®åº“ç®¡ç†

- **URL**: http://localhost:8080
- **ç³»ç»Ÿ**: PostgreSQL
- **æœåŠ¡å™¨**: db (å®¹å™¨å†…) æˆ– localhost (æœ¬åœ°)
- **ç”¨æˆ·å**: dietuser
- **å¯†ç **: dietpass
- **æ•°æ®åº“**: diet_estimator

## æ•°æ®åº“ç®¡ç†

### ä½¿ç”¨Alembicè¿›è¡Œæ•°æ®åº“è¿ç§»

```powershell
cd Backend

# è‡ªåŠ¨æ£€æµ‹æ¨¡å‹å˜åŒ–å¹¶ç”Ÿæˆè¿ç§»æ–‡ä»¶
alembic revision --autogenerate -m "æè¿°å˜æ›´å†…å®¹"

# æŸ¥çœ‹å¾…æ‰§è¡Œçš„è¿ç§»
alembic current
alembic history

# åº”ç”¨è¿ç§»åˆ°æœ€æ–°ç‰ˆæœ¬
alembic upgrade head

# å›æ»šåˆ°ä¸Šä¸€ç‰ˆæœ¬
alembic downgrade -1
```

**æç¤º**: `run.py` å¯åŠ¨æ—¶ä¼šè‡ªåŠ¨æ‰§è¡Œ `alembic upgrade head`

### å¸¸è§æ•°æ®åº“æ“ä½œ

```powershell
# æŸ¥çœ‹æ•°æ®åº“å®¹å™¨æ—¥å¿—
docker-compose -f docker/docker-compose.dev.yml logs db

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker-compose -f docker/docker-compose.dev.yml exec db psql -U dietuser -d diet_estimator

# å¤‡ä»½æ•°æ®åº“
docker-compose -f docker/docker-compose.dev.yml exec db pg_dump -U dietuser diet_estimator > backup.sql

# æ¢å¤æ•°æ®åº“
cat backup.sql | docker-compose -f docker/docker-compose.dev.yml exec -T db psql -U dietuser -d diet_estimator
```

## ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. å‡†å¤‡ç¯å¢ƒé…ç½®

```powershell
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®æ–‡ä»¶
copy .env.example .env.prod

# ç¼–è¾‘ .env.prodï¼Œè®¾ç½®å®‰å…¨çš„å¯†ç å’Œå¯†é’¥
# å¿…é¡»è®¾ç½®: PROD_DB_PASSWORD
```

### 2. å¯åŠ¨ç”Ÿäº§æœåŠ¡

```powershell
# ä½¿ç”¨ç”Ÿäº§é…ç½®å¯åŠ¨
docker-compose -f docker/docker-compose.prod.yml --env-file .env.prod up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose -f docker/docker-compose.prod.yml ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker/docker-compose.prod.yml logs -f
```

### 3. è®¿é—®ç”Ÿäº§æœåŠ¡

- **å‰ç«¯**: http://your-domain:5176
- **ä¸»åç«¯API**: http://your-domain:8000
- **AIåç«¯API**: http://your-domain:8001

### 4. ç”Ÿäº§ç¯å¢ƒç®¡ç†

```powershell
# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose -f docker/docker-compose.prod.yml restart backend

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
docker stats

# æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
docker system prune -a
```

### ç”Ÿäº§ç¯å¢ƒæ³¨æ„äº‹é¡¹

- âœ… ä½¿ç”¨å¼ºå¯†ç  (`.env.prod` ä¸­çš„ `PROD_DB_PASSWORD`)
- âœ… é…ç½®HTTPS (å»ºè®®ä½¿ç”¨Nginxåå‘ä»£ç† + Let's Encrypt)
- âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“
- âœ… ç›‘æ§æ—¥å¿—å’Œèµ„æºä½¿ç”¨
- âœ… è®¾ç½®é˜²ç«å¢™è§„åˆ™ï¼Œä»…å¼€æ”¾å¿…è¦ç«¯å£
- âŒ ç”Ÿäº§ç¯å¢ƒä¸åŒ…å«Adminer


## è´¡çŒ®æŒ‡å—

1. Forkæœ¬ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request
